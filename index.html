<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nigeria PAYE Calculator (New Tax Reform)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- OCR -->
<script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#eef2f7,#f9fafb);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.card{
  max-width:520px;
  width:100%;
  background:#fff;
  border-radius:18px;
  padding:26px;
  box-shadow:0 20px 40px rgba(0,0,0,.12);
}
h2{text-align:center;margin-bottom:6px;}
p.subtitle{text-align:center;color:#64748b;font-size:14px;margin-bottom:20px;}
label{font-weight:600;font-size:14px;display:block;margin-top:12px;}
input,button{
  width:100%;
  padding:12px;
  margin-top:6px;
  font-size:15px;
  border-radius:10px;
}
input{border:1px solid #cbd5e1;}
button{
  border:none;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button:hover{background:#1e40af;}
.divider{
  text-align:center;
  margin:20px 0;
  color:#94a3b8;
  font-size:13px;
}
.result{
  margin-top:18px;
  background:#f1f5f9;
  padding:16px;
  border-radius:12px;
  font-size:14px;
  line-height:1.6;
}
.loading{text-align:center;color:#b45309;margin-top:10px;}
.preview img{
  max-width:100%;
  margin-top:10px;
  border-radius:10px;
}
.footer{text-align:center;font-size:12px;color:#94a3b8;margin-top:18px;}
</style>
</head>

<body>

<div class="card">
<h2>ðŸ‡³ðŸ‡¬ PAYE Calculator</h2>
<p class="subtitle">New Nigerian Tax Reform â€¢ Manual or Payslip Upload</p>

<!-- ================= MANUAL PAYE ================= -->
<label>Monthly Gross Salary (â‚¦)</label>
<input type="number" id="manualSalary" placeholder="e.g. 92508">
<button onclick="calculateManualPAYE()">Calculate PAYE</button>

<div class="divider">â€” OR UPLOAD PAYSLIP â€”</div>

<!-- ================= UPLOAD ================= -->
<label>Upload Payslip (JPG / PNG)</label>
<input type="file" id="fileInput" accept="image/*">
<div class="preview" id="preview"></div>

<button onclick="processPayslip()">Process Payslip</button>

<p class="loading" id="loading"></p>
<div class="result" id="result"></div>

<div class="footer">Â© 2026 Muhztech PAYE Automation</div>
</div>

<script>
/* ================= TAX LOGIC ================= */
const EXEMPT = 800000;
const BANDS = [
  {limit:2200000, rate:0.15},
  {limit:9000000, rate:0.18},
  {limit:13000000, rate:0.21},
  {limit:25000000, rate:0.23},
  {limit:Infinity, rate:0.25}
];

function computePAYE(monthlyGross){
  let annual = monthlyGross * 12;
  let tax = 0;
  if(annual > EXEMPT){
    let remaining = annual - EXEMPT;
    for(let b of BANDS){
      if(remaining<=0) break;
      let amt = Math.min(b.limit, remaining);
      tax += amt * b.rate;
      remaining -= amt;
    }
  }
  return tax / 12;
}

/* ================= MANUAL ================= */
function calculateManualPAYE(){
  const val = Number(document.getElementById("manualSalary").value);
  if(val<=0){alert("Enter valid salary");return;}
  const paye = computePAYE(val);
  document.getElementById("result").innerHTML =
    `<b>Monthly Gross:</b> â‚¦${val.toLocaleString()}<br>
     <b>Correct PAYE:</b> â‚¦${paye.toLocaleString()}`;
}

/* ================= PREVIEW ================= */
const preview = document.getElementById("preview");
document.getElementById("fileInput").addEventListener("change", e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ev => preview.innerHTML = `<img src="${ev.target.result}">`;
  r.readAsDataURL(f);
});

/* ================= OCR ================= */
function processPayslip(){
  const file = document.getElementById("fileInput").files[0];
  if(!file){alert("Upload a payslip");return;}
  document.getElementById("loading").innerText="Reading payslipâ€¦";

  Tesseract.recognize(file,"eng")
  .then(({data:{text}})=>{
    document.getElementById("loading").innerText="";
    const clean = text.toUpperCase().replace(/â‚¦|,/g,"").replace(/\s+/g," ");

    let gross =
      extract(clean,["GROSS PAY","TOTAL EMOLUMENT","TOTAL PAY","GROSS"]) ||
      sumParts(clean);

    if(!gross){
      alert("OCR failed. Please enter salary manually.");
      return;
    }

    const newPAYE = computePAYE(gross);
    document.getElementById("result").innerHTML =
      `<b>Detected Gross:</b> â‚¦${gross.toLocaleString()}<br>
       <b>Correct PAYE (New Law):</b> â‚¦${newPAYE.toLocaleString()}`;
  });
}

/* ================= HELPERS ================= */
function extract(text, keys){
  for(let k of keys){
    let r = new RegExp(k+"[^0-9]{0,15}([0-9]{3,9})");
    let m = text.match(r);
    if(m) return Number(m[1]);
  }
  return null;
}

function sumParts(text){
  let sum = 0;
  ["BASIC","HOUSING","TRANSPORT","ALLOWANCE","RENT"].forEach(k=>{
    let r = new RegExp(k+"[^0-9]{0,15}([0-9]{3,9})","g");
    let m;
    while((m=r.exec(text))!==null) sum+=Number(m[1]);
  });
  return sum>0?sum:null;
}
</script>

</body>
</html>
