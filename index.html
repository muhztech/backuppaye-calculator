<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nigeria PAYE Comparison Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#eef2f7,#f9fafb);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.card{
  max-width:560px;
  width:100%;
  background:#fff;
  border-radius:18px;
  padding:26px;
  box-shadow:0 20px 40px rgba(0,0,0,.12);
}
h2{text-align:center;}
.subtitle{text-align:center;color:#64748b;font-size:14px;margin-bottom:20px;}
label{font-weight:600;font-size:14px;display:block;margin-top:12px;}
input,button{
  width:100%;
  padding:12px;
  margin-top:6px;
  font-size:15px;
  border-radius:10px;
}
input{border:1px solid #cbd5e1;}
button{
  border:none;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button.secondary{background:#0f766e;}
button.danger{background:#b91c1c;}
button:hover{opacity:.9}
.divider{text-align:center;margin:20px 0;color:#94a3b8;}
.result{
  margin-top:18px;
  background:#f1f5f9;
  padding:16px;
  border-radius:12px;
  font-size:14px;
  line-height:1.7;
}
.good{color:#15803d;font-weight:600;}
.bad{color:#b91c1c;font-weight:600;}
.loading{text-align:center;color:#b45309;margin-top:10px;}
.preview img, video{
  width:100%;
  margin-top:10px;
  border-radius:10px;
}
.footer{text-align:center;font-size:12px;color:#94a3b8;margin-top:18px;}
.hidden{display:none;}
</style>
</head>

<body>

<div class="card">
<h2>MUHZTECH üá≥üá¨ PAYE Comparison</h2>
<p class="subtitle">Old PAYE vs New Nigerian Tax Reform</p>

<!-- MANUAL -->
<label>Monthly Gross Salary (‚Ç¶)</label>
<input type="number" id="manualSalary">

<label>Current Monthly PAYE (‚Ç¶)</label>
<input type="number" id="manualOldPAYE">

<button onclick="manualCompare()">Compare PAYE</button>

<div class="divider">‚Äî PAYSLIP OPTIONS ‚Äî</div>

<!-- FILE UPLOAD -->
<label>Choose Payslip Image</label>
<input type="file" id="fileInput" accept="image/*">

<!-- CAMERA CONTROLS -->
<button class="secondary" onclick="startCamera()">üì∑ Start Live Camera</button>
<button class="danger hidden" id="stopBtn" onclick="stopCamera()">‚úñ Stop Camera</button>
<button class="secondary hidden" id="scanBtn" onclick="scanFrame()">üîç Scan from Camera</button>

<!-- VIDEO PREVIEW -->
<video id="video" autoplay playsinline class="hidden"></video>

<!-- IMAGE PREVIEW -->
<div class="preview" id="preview"></div>

<button onclick="processPayslip()">Process Payslip</button>

<p class="loading" id="loading"></p>
<div class="result" id="result"></div>

<div class="footer">¬© 2026 Muhztech PAYE Automation</div>
</div>

<canvas id="canvas" class="hidden"></canvas>

<script>
/* ===== TAX LOGIC ===== */
const EXEMPT = 800000;
const BANDS = [
  {limit:2200000, rate:0.15},
  {limit:9000000, rate:0.18},
  {limit:13000000, rate:0.21},
  {limit:25000000, rate:0.23},
  {limit:Infinity, rate:0.25}
];

function computeNewPAYE(monthlyGross){
  let annual = monthlyGross * 12;
  let tax = 0;
  if(annual > EXEMPT){
    let rem = annual - EXEMPT;
    for(let b of BANDS){
      if(rem<=0) break;
      let amt = Math.min(b.limit, rem);
      tax += amt * b.rate;
      rem -= amt;
    }
  }
  return tax / 12;
}

/* ===== MANUAL ===== */
function manualCompare(){
  const gross = Number(manualSalary.value);
  const oldPAYE = Number(manualOldPAYE.value);
  if(gross<=0 || oldPAYE<0) return alert("Invalid input");
  showComparison(gross, oldPAYE);
}

/* ===== FILE PICKER ===== */
let selectedImage = null;

fileInput.addEventListener("change", e=>{
  selectedImage = e.target.files[0];
  if(!selectedImage) return;

  const r = new FileReader();
  r.onload = ev => preview.innerHTML = `<img src="${ev.target.result}">`;
  r.readAsDataURL(selectedImage);
});

/* ===== LIVE CAMERA ===== */
let stream = null;

async function startCamera(){
  stream = await navigator.mediaDevices.getUserMedia({
    video:{facingMode:"environment"}
  });
  video.srcObject = stream;
  video.classList.remove("hidden");
  scanBtn.classList.remove("hidden");
  stopBtn.classList.remove("hidden");
}

function stopCamera(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    stream=null;
  }
  video.classList.add("hidden");
  scanBtn.classList.add("hidden");
  stopBtn.classList.add("hidden");
}

/* ===== CAPTURE FRAME ===== */
function scanFrame(){
  const canvas = document.getElementById("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video,0,0);

  canvas.toBlob(blob=>{
    selectedImage = blob;
    preview.innerHTML = `<img src="${URL.createObjectURL(blob)}">`;
    stopCamera();
  });
}

/* ===== OCR ===== */
function processPayslip(){
  if(!selectedImage){
    alert("Upload, capture, or scan a payslip");
    return;
  }

  loading.innerText="Reading payslip‚Ä¶";

  Tesseract.recognize(selectedImage,"eng")
  .then(({data:{text}})=>{
    loading.innerText="";

    const t = text.toUpperCase().replace(/‚Ç¶|,/g,"").replace(/\s+/g," ");

    const gross =
      extract(t,["GROSS PAY","TOTAL EMOLUMENT","TOTAL PAY","GROSS"]) ||
      sumParts(t);

    const oldPAYE =
      extract(t,["PAYE","PAY AS YOU EARN","TAX"]) || 0;

    if(!gross) return alert("Gross Pay not detected");

    showComparison(gross, oldPAYE);
  })
  .catch(()=>loading.innerText="OCR failed");
}

/* ===== DISPLAY ===== */
function showComparison(gross, oldPAYE){
  const newPAYE = computeNewPAYE(gross);
  const diff = oldPAYE - newPAYE;

  result.innerHTML = `
    <b>Monthly Gross:</b> ‚Ç¶${gross.toLocaleString()}<br>
    <b>Old PAYE:</b> ‚Ç¶${oldPAYE.toLocaleString()}<br>
    <b>New PAYE:</b> ‚Ç¶${newPAYE.toLocaleString()}<hr>
    <b>Status:</b>
    ${diff>0?`<span class="good">Overpaid ‚Ç¶${diff.toLocaleString()}</span>`:
      diff<0?`<span class="bad">Underpaid ‚Ç¶${Math.abs(diff).toLocaleString()}</span>`:
      `<span class="good">Correctly Taxed</span>`}
  `;
}

/* ===== HELPERS ===== */
function extract(text, keys){
  for(let k of keys){
    let r = new RegExp(k+"[^0-9]{0,15}([0-9]{3,9})");
    let m = text.match(r);
    if(m) return Number(m[1]);
  }
  return null;
}
function sumParts(text){
  let sum=0;
  ["BASIC","HOUSING","TRANSPORT","ALLOWANCE","RENT"].forEach(k=>{
    let r=new RegExp(k+"[^0-9]{0,15}([0-9]{3,9})","g");
    let m; while((m=r.exec(text))!==null) sum+=Number(m[1]);
  });
  return sum||null;
}
</script>

</body>
</html>
