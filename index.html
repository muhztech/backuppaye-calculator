<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nigeria PAYE Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Tesseract OCR -->
  <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box;}
    body{
      font-family:'Inter',sans-serif;
      background:
        radial-gradient(circle at top left, #e0eaff, transparent 60%),
        radial-gradient(circle at bottom right, #fef3c7, transparent 55%),
        linear-gradient(135deg, #eef2f7, #f9fafb);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:480px;
      background:rgba(255,255,255,0.92);
      backdrop-filter:blur(12px);
      border-radius:18px;
      padding:30px;
      box-shadow:0 20px 45px rgba(15,23,42,0.12);
    }
    .header{text-align:center;margin-bottom:26px;}
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      background:#e0ecff;
      color:#1d4ed8;
      font-size:12px;
      font-weight:600;
      margin-bottom:10px;
    }
    .header h2{font-size:22px;font-weight:700;color:#0f172a;margin-bottom:6px;}
    .header p{font-size:14px;color:#64748b;}
    label{font-size:14px;font-weight:600;color:#334155;margin-bottom:8px;display:block;}
    .upload-box{display:flex;flex-direction:column;gap:12px;margin-bottom:12px;}
    .upload-box button{
      width:100%;padding:12px;border-radius:12px;border:none;
      background:linear-gradient(135deg, #2563eb, #1e40af);
      color:#fff;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.25s ease;
    }
    .upload-box button:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 24px rgba(37,99,235,0.35);
    }
    .upload-box input[type="file"]{display:none;}
    .hint{font-size:12px;color:#64748b;text-align:center;}
    .preview-container{margin-top:10px;text-align:center;}
    .preview-container img{max-width:100%;border-radius:12px;margin-top:6px;box-shadow:0 6px 18px rgba(0,0,0,0.1);}
    button.process-btn{
      width:100%;margin-top:12px;padding:14px;border-radius:14px;border:none;
      background:linear-gradient(135deg, #2563eb, #1e40af);
      color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.25s ease;
    }
    button.process-btn:hover{
      transform:translateY(-2px);box-shadow:0 14px 28px rgba(37,99,235,0.35);
    }
    .loading{margin-top:16px;text-align:center;font-size:14px;font-weight:500;color:#b45309;}
    .result{margin-top:18px;padding:16px;border-radius:14px;background:linear-gradient(135deg,#f8fafc,#eef2f7);border:1px solid #e5e7eb;font-size:14px;color:#0f172a;line-height:1.7;}
    .footer{margin-top:22px;text-align:center;font-size:12px;color:#94a3b8;}
  </style>
</head>
<body>

  <div class="card">
    <div class="header">
      <div class="badge">PAYE ‚Ä¢ OCR Powered</div>
      <h2>Muhztech PAYE Calculator</h2>
      <p>Take a photo or upload your payslip</p>
    </div>

    <label>Upload / Capture Payslip</label>
    <div class="upload-box">
      <button type="button" onclick="document.getElementById('cameraInput').click()">üì∑ Take Photo</button>
      <input type="file" id="cameraInput" accept="image/*" capture>
      <button type="button" onclick="document.getElementById('galleryInput').click()">üìÅ Upload from Gallery</button>
      <input type="file" id="galleryInput" accept="image/*">
      <div class="hint">Take a photo or select from gallery ‚Ä¢ JPG / PNG ‚Ä¢ Recommended under 3MB</div>
    </div>

    <div class="preview-container" id="previewContainer"></div>

    <button class="process-btn" onclick="processSelectedFile()">Process Payslip</button>

    <p class="loading" id="loading"></p>
    <div class="result" id="result"></div>

    <div class="footer">¬© 2026 Muhztech ¬∑ PAYE Automation System</div>
  </div>

  <script>
    let selectedFile = null;
    const previewContainer = document.getElementById('previewContainer');

    function showPreview(file){
      const reader = new FileReader();
      reader.onload = e => {
        previewContainer.innerHTML = `<img src="${e.target.result}" alt="Payslip Preview">`;
      };
      reader.readAsDataURL(file);
    }

    document.getElementById('cameraInput').addEventListener('change', e => {
      if(e.target.files.length){
        selectedFile = e.target.files[0];
        showPreview(selectedFile);
      }
    });

    document.getElementById('galleryInput').addEventListener('change', e => {
      if(e.target.files.length){
        selectedFile = e.target.files[0];
        showPreview(selectedFile);
      }
    });

    function processSelectedFile(){
      if(!selectedFile){
        alert("Please take a photo or upload a payslip first!");
        return;
      }
      processPayslip(selectedFile);
    }

    // --- Updated processPayslip function ---
    function processPayslip(file){
      if(!file){
        alert("Please upload a payslip");
        return;
      }

      document.getElementById("loading").innerText = "Reading payslip... Please wait";

      Tesseract.recognize(file, 'eng', {logger: m => console.log(m)})
      .then(({ data: { text } }) => {
        document.getElementById("loading").innerText = "";
        text = text.toUpperCase();

        let gross = extractAmount(text, ["GROSS PAY","GROSS"]);
        let pension = extractAmount(text, ["PENSION"]);
        let payeCurrent = extractAmount(text, ["PAYE","PAY AS YOU EARN"]);

        if(!gross){
          alert("Could not detect Gross Pay. Try a clearer payslip.");
          return;
        }

        calculateNewPAYE(gross, pension||0, payeCurrent||0);
      })
      .catch(err => { alert("Error reading payslip"); console.error(err); });
    }

    function extractAmount(text, keywords){
      for(let key of keywords){
        let regex = new RegExp(key+"[^0-9]*([0-9,.]+)");
        let match = text.match(regex);
        if(match) return Number(match[1].replace(/,/g,""));
      }
      return null;
    }

    function calculateNewPAYE(monthlyGross,pensionMonthly,currentPAYE){
      let annualIncome = monthlyGross*12;
      let pensionAnnual = pensionMonthly*12;
      let taxableIncome = annualIncome - pensionAnnual;
      let tax = 0;
      if(taxableIncome>800000){
        let remaining = taxableIncome - 800000;
        let bands=[
          {limit:2200000, rate:0.15},
          {limit:9000000, rate:0.18},
          {limit:13000000, rate:0.21},
          {limit:25000000, rate:0.23},
          {limit:Infinity, rate:0.25}
        ];
        for(let band of bands){
          if(remaining<=0) break;
          let amount=Math.min(band.limit,remaining);
          tax+=amount*band.rate;
          remaining-=amount;
        }
      }
      let monthlyNewPAYE = tax/12;
      let difference = currentPAYE - monthlyNewPAYE;
      document.getElementById("result").innerHTML=`
        <p><b>Detected Gross Pay:</b> ‚Ç¶${monthlyGross.toLocaleString()}</p>
        <p><b>Detected Pension:</b> ‚Ç¶${pensionMonthly.toLocaleString()}</p>
        <p><b>Current PAYE:</b> ‚Ç¶${currentPAYE.toLocaleString()}</p>
        <hr>
        <p><b>Correct PAYE (New Law):</b> ‚Ç¶${monthlyNewPAYE.toLocaleString()}</p>
        <p><b>Difference:</b> ‚Ç¶${difference.toLocaleString()}</p>
      `;
    }
  </script>
</body>
</html>
