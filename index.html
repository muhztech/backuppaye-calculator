<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nigeria PAYE Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Tesseract OCR -->
  <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}
    body{
      font-family:'Inter',sans-serif;
      background:
        radial-gradient(circle at top left, #e0eaff, transparent 60%),
        radial-gradient(circle at bottom right, #fef3c7, transparent 55%),
        linear-gradient(135deg, #eef2f7, #f9fafb);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:480px;
      background:rgba(255,255,255,0.95);
      border-radius:18px;
      padding:30px;
      box-shadow:0 20px 45px rgba(15,23,42,.12);
    }
    .header{text-align:center;margin-bottom:22px}
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      background:#e0ecff;
      color:#1d4ed8;
      font-size:12px;
      font-weight:600;
      margin-bottom:10px;
    }
    h2{margin:0;font-size:22px;font-weight:700}
    p{margin:4px 0;color:#64748b;font-size:14px}
    button{
      width:100%;
      padding:14px;
      margin-top:10px;
      border:none;
      border-radius:14px;
      background:linear-gradient(135deg,#2563eb,#1e40af);
      color:#fff;
      font-size:15px;
      font-weight:600;
      cursor:pointer;
    }
    button:hover{opacity:.95}
    input[type=file]{display:none}
    .preview img{
      max-width:100%;
      margin-top:10px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.15);
    }
    .loading{
      margin-top:14px;
      font-size:14px;
      color:#b45309;
      text-align:center;
    }
    .result{
      margin-top:18px;
      padding:16px;
      border-radius:14px;
      background:#f8fafc;
      border:1px solid #e5e7eb;
      font-size:14px;
      line-height:1.7;
    }
    .footer{
      margin-top:20px;
      font-size:12px;
      color:#94a3b8;
      text-align:center;
    }
  </style>
</head>
<body>

<div class="card">
  <div class="header">
    <div class="badge">PAYE ‚Ä¢ OCR Powered</div>
    <h2>Muhztech PAYE Calculator</h2>
    <p>Upload or capture your payslip</p>
  </div>

  <!-- FILE INPUT -->
  <input
    type="file"
    id="fileInput"
    accept="image/*"
    capture="environment"
  >

  <button onclick="openCamera()">üì∑ Capture Payslip</button>
  <button onclick="openGallery()">üìÅ Upload from Gallery</button>

  <div class="preview" id="preview"></div>

  <button onclick="processPayslip()">Process Payslip</button>

  <div class="loading" id="loading"></div>
  <div class="result" id="result"></div>

  <div class="footer">¬© 2026 Muhztech ¬∑ PAYE Automation System</div>
</div>

<script>
  const fileInput = document.getElementById("fileInput");
  let selectedFile = null;

  function openCamera(){
    fileInput.setAttribute("capture","environment");
    fileInput.click();
  }

  function openGallery(){
    fileInput.removeAttribute("capture");
    fileInput.click();
  }

  fileInput.addEventListener("change", function(){
    selectedFile = this.files[0];
    if(!selectedFile) return;

    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById("preview").innerHTML =
        `<img src="${e.target.result}" alt="Payslip Preview">`;
    };
    reader.readAsDataURL(selectedFile);
  });

  function processPayslip(){
    if(!selectedFile){
      alert("Please upload or capture a payslip first");
      return;
    }

    document.getElementById("loading").innerText =
      "Reading payslip... Please wait";

    Tesseract.recognize(selectedFile, "eng")
      .then(({data:{text}})=>{
        document.getElementById("loading").innerText="";
        text=text.toUpperCase();

        const gross = extractAmount(text,["GROSS PAY","GROSS"]);
        const pension = extractAmount(text,["PENSION"]) || 0;
        const currentPAYE = extractAmount(text,["PAYE","PAY AS YOU EARN"]) || 0;

        if(!gross){
          alert("Could not detect Gross Pay. Try a clearer image.");
          return;
        }

        calculateNewPAYE(gross,pension,currentPAYE);
      })
      .catch(err=>{
        console.error(err);
        alert("OCR failed. Try another image.");
      });
  }

  function extractAmount(text,keys){
    for(let k of keys){
      const regex = new RegExp(k+"[^0-9]*([0-9,.]+)");
      const match = text.match(regex);
      if(match) return Number(match[1].replace(/,/g,""));
    }
    return null;
  }

  function calculateNewPAYE(monthlyGross,pensionMonthly,currentPAYE){
    const annualIncome = monthlyGross*12;
    const pensionAnnual = pensionMonthly*12;
    let taxable = annualIncome - pensionAnnual - 800000;

    let tax = 0;
    const bands=[
      {limit:2200000,rate:.15},
      {limit:9000000,rate:.18},
      {limit:13000000,rate:.21},
      {limit:25000000,rate:.23},
      {limit:Infinity,rate:.25}
    ];

    if(taxable>0){
      for(let b of bands){
        if(taxable<=0) break;
        let amt=Math.min(b.limit,taxable);
        tax+=amt*b.rate;
        taxable-=amt;
      }
    }

    const newMonthlyPAYE = tax/12;
    const diff = currentPAYE - newMonthlyPAYE;

    document.getElementById("result").innerHTML=`
      <b>Detected Gross Pay:</b> ‚Ç¶${monthlyGross.toLocaleString()}<br>
      <b>Detected Pension:</b> ‚Ç¶${pensionMonthly.toLocaleString()}<br>
      <b>Current PAYE:</b> ‚Ç¶${currentPAYE.toLocaleString()}
      <hr>
      <b>Correct PAYE (New Law):</b> ‚Ç¶${newMonthlyPAYE.toLocaleString()}<br>
      <b>Difference:</b> ‚Ç¶${diff.toLocaleString()}
    `;
  }
</script>

</body>
</html>